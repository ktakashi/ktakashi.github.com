<!DOCTYPE html>
<html>
  <head>
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <div class="prev-next">
    <a class="prev" href="section66.html">(sagittarius object) - Convenient refs and coercion procedures</a>
    <a class="top" href="../sagittarius-online-ref.html">Top</a>
    <a class="next" href="section68.html">(sagittarius reader) - reader macro library</a>
  </div>
  <section class="subsection"><h3 class="subsection">
    <a class="section.anchor" name="lib.sagittarius.process"><span class="section-number">6.7</span>(sagittarius process) - Process  library</a>
  </h3>
<p />In real world, there are a lot of useful programs and you want to re-use it
rather than re-write it in Scheme. For that purpose, this library can be useful.
<p />The concept of this library is similar with Java's Process class. Users can
create process object and run/call whenever they want. However most of the time
process can be invoked immediately, so there are high level APIs for that
purpose.
<p />This section describe from top to down.
<p /><div class="define">
    <span class="define-category">Library</span>
    <a name="(sagittarius process)1124">
      <span class="name" name="(sagittarius process)">(sagittarius process)</span>
    </a>
  </div>
<div class="desc">Exports high level APIs and low level APIs for operating process.</div>
<p /><section class="subsubsection"><h4 class="subsubsection">
    <a class="section.anchor" name="G1125"><span class="section-number">6.7.1</span>High level APIs</a>
  </h4>
<p /><div class="define"><span class="define-category">Function</span><a name="run1126">
    <span class="name" name="run">run</span>
  </a> <span class="args">name arg1 ...</span></div>
<div class="define"><span class="define-category">Function</span><a name="call1127">
    <span class="name" name="call">call</span>
  </a> <span class="args">name arg1 ...</span></div>
<div class="desc"><var>name</var> must be string and indicate the process name be called.
<p /><var>arg1</var> and the rest must be string which will be passed to process.
<p />The <code>run</code> procedure invokes <var>name</var> process and waits until it ends.
Then returns process' exit status.
<p />The <code>call</code> procedure invokes <var>name</var> process and continue the Scheme
process, so it does not wait the called process. Then returns process object.
If you need to finish the process, make sure you call the <code>process-wait</code>
procedure described below.
<p />Both procedures' output will be redirects <code>current-output-port</code> and
<code>current-error-port</code>. If you need to redirect it other place use
<code>create-process</code> described below.
</div>
<p /></section><section class="subsubsection"><h4 class="subsubsection">
    <a class="section.anchor" name="G1128"><span class="section-number">6.7.2</span>Middle level APIs</a>
  </h4>
<p /><div class="define"><span class="define-category">Function</span><a name="create-process1129">
    <span class="name" name="create-process">create-process</span>
  </a>
 <span class="args">name args
  :key (stdout #f) (stderr #f) (call? #t) reader (transcoder #f)</span></div>
<div class="desc"><var>name</var> must be string and indicate a process name.
<p /><var>args</var> must be list of string will be passed to the process.
<p />The <code>create-process</code> procedure creates and invokes a process indicated
<var>name</var>. Keyword arguments decide how to invoke and where to redirect the
outputs.
<p />If <var>stdout</var> is #f or non output-port and <var>call?</var> is #f then
<code>create-process</code> raises <code>&amp;assertion</code>.
<p /><var>stdout</var> keyword argument indicates the port where to redirect the standard
output of the process. This can be either binary output port or textual output
port.
<p /><var>stderr</var> keyword argument indicates the port where to redirect the standard
error of the process. This can be either binary output port or textual output
port. If this argument is #f, then <var>stdout</var> will be used.
<p /><var>call?</var> keyword argument decides the behaviour. If this is #t, then the
process will be waited until its end. Otherwise just invokes it and returns
process object.
<p /><var>reader</var> keyword argument must be procedure which takes 4 arguments,
process object, redirection of standard output and error, and transcoder
respectively. This procedure decides how to handle the output. the default
implementation is like this:
<pre class="codeblock">(define (async-process-read process stdout stderr transcoder)
  (define (pipe-read in out reader converter)
    (let loop ((r (reader in)))
      (unless (eof-object? r)
	(display (converter r) out)
	(loop (reader in)))))
  (let ((out-thread (make-thread
		     (lambda ()
		       (let ((in (process-output-port process)))
			 (if transcoder
			     (pipe-read (transcoded-port in transcoder)
					stdout
					get-char
					(lambda (x) x))
			     (pipe-read in stdout get-u8 integer-&gt;char))))))
	(err-thread (make-thread
		     (lambda ()
		       (let ((in (process-error-port process)))
			 (if transcoder
			     (pipe-read (transcoded-port in transcoder)
					stderr
					get-char
					(lambda (x) x))
			     (pipe-read in stderr get-u8 integer-&gt;char)))))))
    (thread-start! out-thread)
    (thread-start! err-thread)))
</pre>
This might not be efficient, so user can specify how to behave.
<p />Note: on Windows, both standard output end error has limitation. So if you
replace the default behaviour, make sure you must read the output from the
process, otherwise it can cause deat lock.
<p /><var>transcoder</var> keyword argument must be transcoder or #f. This can be used in
the procedure which specified <var>reader</var> keyword argument.
</div>
<p /></section><section class="subsubsection"><h4 class="subsubsection">
    <a class="section.anchor" name="G1130"><span class="section-number">6.7.3</span>Low level APIs</a>
  </h4>
<p />This section describe low level APIs however some of these might be used even
if you use <code>call</code> described above.
<p /><div class="define"><span class="define-category">Function</span><a name="process?1131">
    <span class="name" name="process?">process?</span>
  </a> <span class="args">obj</span></div>
<div class="desc">Returns #f if <var>obj</var> is process object, otherwise #f.</div>
<p /><div class="define"><span class="define-category">Function</span><a name="make-process1132">
    <span class="name" name="make-process">make-process</span>
  </a> <span class="args">name args</span></div>
<div class="desc"><var>name</var> must be string and indicates the process name which will be
invoked.
<p /><var>args</var> must be empty list or list of strings and will be passed to the
process.
<p />Creates a process object.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="process-input-port1133">
    <span class="name" name="process-input-port">process-input-port</span>
  </a> <span class="args">process</span></div>
<div class="desc"><var>process</var> must be a process object.
<p />Returns the binary output port which is redirected to the process'
standard input.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="process-output-port1134">
    <span class="name" name="process-output-port">process-output-port</span>
  </a> <span class="args">process</span></div>
<div class="desc"><var>process</var> must be a process object.
<p />Returns the binary input port which is redirected to the process'
standard output.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="process-error-port1135">
    <span class="name" name="process-error-port">process-error-port</span>
  </a> <span class="args">process</span></div>
<div class="desc"><var>process</var> must be a process object.
<p />Returns the binary input port which is redirected to the process'
standard error.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="process-run1136">
    <span class="name" name="process-run">process-run</span>
  </a> <span class="args">process</span></div>
<div class="desc"><var>process</var> must be a process object.
<p />Invokes the <var>process</var> and wait until it ends.
<p />On POSIX envionment this procesure returns the result status of the process.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="process-call1137">
    <span class="name" name="process-call">process-call</span>
  </a> <span class="args">process</span></div>
<div class="desc"><var>process</var> must be a process object.
<p />Invokes the <var>process</var> and continue the Scheme program.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="process-wait1138">
    <span class="name" name="process-wait">process-wait</span>
  </a> <span class="args">process</span></div>
<div class="desc"><var>process</var> must be a process object.
<p />Wait the given process until it ends and returns the exit status of the given
process.
<p />NOTE: The exit status are platform dependent. On Windows, the value will be
32 bit integer. On POSIX, the value will be 8 bit unsigned integer.
</div>

</section></section>
  <div class="prev-next">
    <a class="prev" href="section66.html">(sagittarius object) - Convenient refs and coercion procedures</a>
    <a class="top" href="../sagittarius-online-ref.html">Top</a>
    <a class="next" href="section68.html">(sagittarius reader) - reader macro library</a>
  </div>
  <hr>
  <div id="document-footer">
    <div id="footer-message">This document was generated by<i>Takashi Kato</i> with Sagittarius gendoc. </div>
    <div id="footer-date">Generated date: <i>2015-04-17T17:08:59+0100</i></div>
  </div>
</html>