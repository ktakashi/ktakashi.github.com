<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <div class="prev-next">
    <a class="prev" href="section21.html">Invoking Sagittarius</a>
    <a class="top" href="../sagittarius-online-ref.html">Top</a>
    <a class="next" href="section23.html">Working on REPL</a>
  </div>
  <section class="subsection"><h3 class="subsection">
    <a class="section.anchor" name="G23"><span class="section-number">2.2</span>Writing Scheme scripts</a>
  </h3>
<p />When a Scheme file is given to <code>sagittarius</code>, it bounds an internal
variable to list of the remaining command-line arguments which you can get with
the <code>command-line</code> procedure, then loads the Scheme program. If the first
line of scheme-file begins with <code>"#!"</code>, then Sagittarius ignores the
entire line. This is useful to write a Scheme program that works as an
executable script in unix-like systems.
<p />Typical Sagittarius script has the first line like this:
<p /><pre class="snipet">#!/usr/local/bin/sagittarius</pre>
<p />or
<p /><pre class="snipet">#!/bin/env sagittarius</pre>
<p />The second form uses "shell trampoline" technique so that the script works as
far as <code>sagittarius</code> is in the PATH.
<p />After the script file is successfully loaded, then Sagittarius will process all
toplevel expression the same as Perl.
<p />Now I show a simple example below. This script works like <code>cat(1)</code>, without
any command-line option processing and error handling.
<p /><pre class="codeblock">#!/usr/local/bin/sagittarius
(import (rnrs))
(let ((args (command-line)))
  (unless (null? (cdr args))
    (for-each (lambda (file)
		(call-with-input-file file
		  (lambda (in)
		    (display (get-string-all in)))))
	      (cdr args)))
  0)
</pre>
<p />If the script file contains <code>main</code> procedure, then Sagittarius execute
it as well with one argument which contains all command line arguments. This
feature is defined in 
<a href="http://srfi.schemers.org/srfi-22/">SRFI-22</a>. So the
above example can also be written like the following:
<p /><pre class="codeblock">#!/usr/local/bin/sagittarius
(import (rnrs))
(define (main args)
  (unless (null? (cdr args))
    (for-each (lambda (file)
		(call-with-input-file file
		  (lambda (in)
		    (display (get-string-all in)))))
	      (cdr args)))
  0)
</pre>
<p />NOTE: the <code>main</code> procedure is called after all toplevel expressions
are executed.
<p /></section>
  <div class="prev-next">
    <a class="prev" href="section21.html">Invoking Sagittarius</a>
    <a class="top" href="../sagittarius-online-ref.html">Top</a>
    <a class="next" href="section23.html">Working on REPL</a>
  </div>
  <hr>
  <div id="document-footer">
    <div id="footer-message">This document was generated by<i>Takashi Kato</i> with Sagittarius gendoc. </div>
    <div id="footer-date">Generated date: <i>2017-06-16T21:23:55+0200</i></div>
  </div>
</html>