<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <div class="prev-next">
    <a class="prev" href="section75.html">(binary pack) - Packing binary data</a>
    <a class="top" href="../sagittarius-online-ref.html">Top</a>
    <a class="next" href="section77.html">(util bytevector) - Bytevector utility library</a>
  </div>
  <section class="subsection"><h3 class="subsection">
    <a class="section.anchor" name="util.buffer"><span class="section-number">7.6</span>(util buffer) - Buffer utilities</a>
  </h3>
<p /><div class="define">
    <span class="define-category">Library</span>
    <a name="(util buffer)1651">
      <span class="name" name="(util buffer)">(util buffer)</span>
    </a>
  </div>
<div class="desc">This library provides buffer utitlities. Currently, it only provides
pre-allocated buffer and its procedures.
</div>
<p /><section class="subsubsection"><h4 class="subsubsection">
    <a class="section.anchor" name="G1652"><span class="section-number">7.6.1</span>Pre-allocated buffer</a>
  </h4>
<p /><div class="define">
    <span class="define-category">Record Type</span>
    <a name="<pre-allocated-buffer&gt;1653">
      <span class="name" name="<pre-allocated-buffer&gt;">&lt;pre-allocated-buffer&gt;</span>
    </a>
  </div>
<div class="desc">Parent type of pre-allocated buffer. This library doesn't expose
the record constructor for this type.
<p />This type contains <code>buffer</code> and <code>size</code> fields.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="pre-allocated-buffer?1654">
    <span class="name" name="pre-allocated-buffer?">pre-allocated-buffer?</span>
  </a> <span class="args">obj</span></div>
<div class="desc">Returns #t if given <var>obj</var> is a pre-allocated buffer. Otherwise #f.</div>
<p /><div class="define"><span class="define-category">Function</span><a name="pre-allocated-buffer-buffer1655">
    <span class="name" name="pre-allocated-buffer-buffer">pre-allocated-buffer-buffer</span>
  </a> <span class="args">buffer</span></div>
<div class="desc">Returns value of <code>buffer</code> field of given <var>buffer</var>.
<p />The type of <code>buffer</code> field is implementation specific.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="pre-allocated-buffer-size1656">
    <span class="name" name="pre-allocated-buffer-size">pre-allocated-buffer-size</span>
  </a> <span class="args">buffer</span></div>
<div class="desc">Returns value of <code>size</code> field of given <var>buffer</var>.
<p />The returning value shall represents how much buffer of the given <var>buffer</var>
is consumed.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="pre-allocated-buffer-reset!1657">
    <span class="name" name="pre-allocated-buffer-reset!">pre-allocated-buffer-reset!</span>
  </a> <span class="args">buffer</span></div>
<div class="desc">Sets 0 to the <code>size</code> field of given <code>buffer</code>.</div>
<p />
</section><section class="subsubsection"><h4 class="subsubsection">
    <a class="section.anchor" name="G1658"><span class="section-number">7.6.2</span>Conditions</a>
  </h4>
<p /><div class="define">
    <span class="define-category">Condition</span>
    <a name="&amp;pre-allocated-buffer-overflow1659">
      <span class="name" name="&amp;pre-allocated-buffer-overflow">&amp;pre-allocated-buffer-overflow</span>
    </a>
  </div>
<div class="desc">Buffer overflow condition. This is raised when an operation tries
to put data exceed the buffer size.
<p />This condition have <code>data</code> field which contains overflowing data.
</div>
<div class="define"><span class="define-category">Function</span><a name="pre-allocated-buffer-overflow?1660">
    <span class="name" name="pre-allocated-buffer-overflow?">pre-allocated-buffer-overflow?</span>
  </a> <span class="args">obj</span></div>
<div class="desc">Returns #t if given <var>obj</var> is <code>&amp;pre-allocated-buffer-overflow</code>
condition, otherwise #f.
</div>
<div class="define"><span class="define-category">Function</span><a name="pre-allocated-buffer-overflow-data1661">
    <span class="name" name="pre-allocated-buffer-overflow-data">pre-allocated-buffer-overflow-data</span>
  </a> <span class="args">condition</span></div>
<div class="desc">Retrieves <code>data</code> field value of <var>condition</var>.
<p />The <var>condition</var> must be a <code>&amp;pre-allocated-buffer-overflow</code> condition.
</div>
<p /></section><section class="subsubsection"><h4 class="subsubsection">
    <a class="section.anchor" name="G1662"><span class="section-number">7.6.3</span>Binary pre-allocated buffer</a>
  </h4>
<p />Binary pre-allocated buffer can be used when users don't want to allocate
bytevector number of times. This buffer can be used like a bytevector.
<p /><div class="define"><span class="define-category">Function</span><a name="make-binary-pre-allocated-buffer1663">
    <span class="name" name="make-binary-pre-allocated-buffer">make-binary-pre-allocated-buffer</span>
  </a> <span class="args">bv</span></div>
<div class="desc">Creates pre-allocated buffer with given bytevector <var>bv</var>.
<p />The returning value is a subtype of <code>&lt;pre-allocated-buffer&gt;</code>.
</div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer?1664">
    <span class="name" name="binary-pre-allocated-buffer?">binary-pre-allocated-buffer?</span>
  </a> <span class="args">obj</span></div>
<div class="desc">Returns #t if given <var>obj</var> is binary pre-allocated buffer, 
otherwise #f.</div>
<p /><section class="sub-section"><h5 class="sub-section">
    <a class="section.anchor" name="G1665"><span class="section-number">7.6.3.1</span>Operations</a>
  </h5>
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-u8!1666">
    <span class="name" name="binary-pre-allocated-buffer-put-u8!">binary-pre-allocated-buffer-put-u8!</span>
  </a> 
 <span class="args">binary-buffer u8</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-u16!1667">
    <span class="name" name="binary-pre-allocated-buffer-put-u16!">binary-pre-allocated-buffer-put-u16!</span>
  </a>
 <span class="args">binary-buffer u16 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-u32!1668">
    <span class="name" name="binary-pre-allocated-buffer-put-u32!">binary-pre-allocated-buffer-put-u32!</span>
  </a>
 <span class="args">binary-buffer u32 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-u64!1669">
    <span class="name" name="binary-pre-allocated-buffer-put-u64!">binary-pre-allocated-buffer-put-u64!</span>
  </a>
 <span class="args">binary-buffer u64 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-s8!1670">
    <span class="name" name="binary-pre-allocated-buffer-put-s8!">binary-pre-allocated-buffer-put-s8!</span>
  </a> 
 <span class="args">binary-buffer s8</span></div>	  
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-s16!1671">
    <span class="name" name="binary-pre-allocated-buffer-put-s16!">binary-pre-allocated-buffer-put-s16!</span>
  </a>
 <span class="args">binary-buffer s16 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-s32!1672">
    <span class="name" name="binary-pre-allocated-buffer-put-s32!">binary-pre-allocated-buffer-put-s32!</span>
  </a>
 <span class="args">binary-buffer s32 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-s64!1673">
    <span class="name" name="binary-pre-allocated-buffer-put-s64!">binary-pre-allocated-buffer-put-s64!</span>
  </a>
 <span class="args">binary-buffer s64 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-f32!1674">
    <span class="name" name="binary-pre-allocated-buffer-put-f32!">binary-pre-allocated-buffer-put-f32!</span>
  </a>
 <span class="args">binary-buffer f32 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-f64!1675">
    <span class="name" name="binary-pre-allocated-buffer-put-f64!">binary-pre-allocated-buffer-put-f64!</span>
  </a>
 <span class="args">binary-buffer f64 endianness</span></div>
<div class="desc">Appending given integer or flonum to <var>binary-buffer</var>. Setting
given values uses the following procedures, respectively:
<p /><code>bytevector-u8-set!</code>
<code>bytevector-u16-set!</code>
<code>bytevector-u32-set!</code>
<code>bytevector-u64-set!</code>
<code>bytevector-s8-set!</code>
<code>bytevector-s16-set!</code>
<code>bytevector-s32-set!</code>
<code>bytevector-s64-set!</code>
<code>bytevector-ieee-single-set!</code>
<code>bytevector-ieee-double-set!</code>
<p />The <var>endianness</var> is passed to the above procedures if required.
<p />This procedure also updates the <code>size</code> field of <var>binary-buffer</var>.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-put-bytevector!1676">
    <span class="name" name="binary-pre-allocated-buffer-put-bytevector!">binary-pre-allocated-buffer-put-bytevector!</span>
  </a>
 <span class="args">binary-buffer bv :optional start count</span></div>
<div class="desc">Appending given bytevector <var>bv</var> to <var>binary-buffer</var>.
<p />Optional arguments <var>start</var> and <var>count</var> specifies from where of
<var>bv</var> and how much bytes need to be put. By default, <var>start</var> is 0
and <var>count</var> is <code>(- (bytevector-length <var>bv</var>) <var>start</var>)</code>.
<p />
This procedure also updates the <code>size</code> field of <var>binary-buffer</var>.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-u8!1677">
    <span class="name" name="binary-pre-allocated-buffer-set-u8!">binary-pre-allocated-buffer-set-u8!</span>
  </a> 
 <span class="args">binary-buffer index u8</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-u16!1678">
    <span class="name" name="binary-pre-allocated-buffer-set-u16!">binary-pre-allocated-buffer-set-u16!</span>
  </a>
 <span class="args">binary-buffer index u16 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-u32!1679">
    <span class="name" name="binary-pre-allocated-buffer-set-u32!">binary-pre-allocated-buffer-set-u32!</span>
  </a>
 <span class="args">binary-buffer index u32 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-u64!1680">
    <span class="name" name="binary-pre-allocated-buffer-set-u64!">binary-pre-allocated-buffer-set-u64!</span>
  </a>
 <span class="args">binary-buffer index u64 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-s8!1681">
    <span class="name" name="binary-pre-allocated-buffer-set-s8!">binary-pre-allocated-buffer-set-s8!</span>
  </a> 
 <span class="args">binary-buffer index s8</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-s16!1682">
    <span class="name" name="binary-pre-allocated-buffer-set-s16!">binary-pre-allocated-buffer-set-s16!</span>
  </a>
 <span class="args">binary-buffer index s16 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-s32!1683">
    <span class="name" name="binary-pre-allocated-buffer-set-s32!">binary-pre-allocated-buffer-set-s32!</span>
  </a>
 <span class="args">binary-buffer index s32 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-s64!1684">
    <span class="name" name="binary-pre-allocated-buffer-set-s64!">binary-pre-allocated-buffer-set-s64!</span>
  </a>
 <span class="args">binary-buffer index s64 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-f32!1685">
    <span class="name" name="binary-pre-allocated-buffer-set-f32!">binary-pre-allocated-buffer-set-f32!</span>
  </a>
 <span class="args">binary-buffer index f32 endianness</span></div>
<div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-f64!1686">
    <span class="name" name="binary-pre-allocated-buffer-set-f64!">binary-pre-allocated-buffer-set-f64!</span>
  </a>
 <span class="args">binary-buffer index f64 endianness</span></div>
<div class="desc">Setting given integer/flonum to <var>binary-buffer</var>. These procedures
are anology of the following procedures, respectively:
<p /><code>bytevector-u8-set!</code>
<code>bytevector-s8-set!</code>
<code>bytevector-u16-set!</code>
<code>bytevector-u32-set!</code>
<code>bytevector-u64-set!</code>
<code>bytevector-s16-set!</code>
<code>bytevector-s32-set!</code>
<code>bytevector-s64-set!</code>
<code>bytevector-ieee-single-set!</code>
<code>bytevector-ieee-double-set!</code>
<p />The <var>endianness</var> is passed to the above procedures if required.
<p />This procedure updates the <code>size</code> field of <var>binary-buffer</var> if
sum of given <var>index</var> and number of bytes set in the buffer exceeds
the size of the buffer.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-set-bytevector!1687">
    <span class="name" name="binary-pre-allocated-buffer-set-bytevector!">binary-pre-allocated-buffer-set-bytevector!</span>
  </a>
 <span class="args">binary-buffer index bv :optional start count</span></div>
<div class="desc">Sets the given <var>bv</var> to <var>binary-buffer</var> at position of 
<var>index</var>.
<p />Optional arguments <var>start</var> and <var>count</var> specifies from where of
<var>bv</var> and how much bytes need to be put. By default, <var>start</var> is 0
and <var>count</var> is <code>(- (bytevector-length <var>bv</var>) <var>start</var>)</code>.
<p />This procedure updates the <code>size</code> field of <var>binary-buffer</var> if
sum of given <var>index</var> and number of bytes set in the buffer exceeds
the size of the buffer.
</div>
<p />All above operations may raises an <code>&amp;pre-allocated-buffer-overflow</code>,
when it tries to exceed the pre-allocated buffer.
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-can-store?1688">
    <span class="name" name="binary-pre-allocated-buffer-can-store?">binary-pre-allocated-buffer-can-store?</span>
  </a>
 <span class="args">binary-buffer count :optional position</span></div>
<div class="desc">Returns #t if <var>binary-buffer</var> can store <var>count</var> bytes.
<p />If optional argument <var>position</var> is given, then the procedure check
from the <var>position</var>.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-swap!1689">
    <span class="name" name="binary-pre-allocated-buffer-swap!">binary-pre-allocated-buffer-swap!</span>
  </a>
 <span class="args">binary-buffer new-buf new-size</span></div>
<div class="desc">Swaps the buffer of <var>binary-buffer</var> with <var>new-buf</var>
and <var>new-size</var>.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="binary-pre-allocated-buffer-get-bytevector-n!1690">
    <span class="name" name="binary-pre-allocated-buffer-get-bytevector-n!">binary-pre-allocated-buffer-get-bytevector-n!</span>
  </a>
 <span class="args">binary-buffer input-port n :optional position</span></div>
<div class="desc">Reads <var>n</var> bytes from given <var>input-port</var> and store it to
<var>binary-buffer</var>.
<p />If optional argument <var>position</var> is given, then the procedure stores
from the <var>position</var>.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="crop-binary-buffer1691">
    <span class="name" name="crop-binary-buffer">crop-binary-buffer</span>
  </a> <span class="args">binary-buffer</span></div>
<div class="desc">Returns newly allocated bytevector which contains range of
0 to <code>size</code> field value of <code>buffer</code> field.
</div>
<p /><div class="define"><span class="define-category">Function</span><a name="-&gt;binary-pre-allocated-buffer-output-port1692">
    <span class="name" name="-&gt;binary-pre-allocated-buffer-output-port">-&gt;binary-pre-allocated-buffer-output-port</span>
  </a>
 <span class="args">binary-buffer</span></div>
<div class="desc">Converts the given <var>binary-buffer</var> to binary output port.
<p />If port operations try to exceed the pre-allocated buffer, then
it raises <code>&amp;pre-allocated-buffer-overflow</code>.
</div>

</section></section></section>
  <div class="prev-next">
    <a class="prev" href="section75.html">(binary pack) - Packing binary data</a>
    <a class="top" href="../sagittarius-online-ref.html">Top</a>
    <a class="next" href="section77.html">(util bytevector) - Bytevector utility library</a>
  </div>
  <hr>
  <div id="document-footer">
    <div id="footer-message">This document was generated by<i>Takashi Kato</i> with Sagittarius gendoc. </div>
    <div id="footer-date">Generated date: <i>2021-09-10T21:24:49+0200</i></div>
  </div>
</html>