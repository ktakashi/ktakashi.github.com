<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <body>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section768.html">(text json schema) - JSON Schema</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section770.html">(text json validator) - JSON validator</a>
    </p>
    <section node-type="section">
      <h2 node-type="header-2">
        <a name="text.json.schema-validator">JSON Schema validator</a>
      </h2>
      <p node-type="paragraph">The following example shows how to use the JSON Schema validator.</p>
      <p node-type="paragraph">The following JSON Schema defines the structure of product catalogue. It's
saved in the file <code node-type="code">product.schema.json</code></p>
      <pre lang="scheme" node-type="block"><code>{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/product.schema.json",
  "title": "Product",
  "description": "A product from Acme's catalog",
  "type": "object",
  "properties": {
    "productId": {
      "description": "The unique identifier for a product",
      "type": "integer"
    },
    "productName": {
      "description": "Name of the product",
      "type": "string"
    },
    "price": {
      "description": "The price of the product",
      "type": "number",
      "exclusiveMinimum": 0
    }
  },
  "required": [ "productId", "productName", "price" ]
}
</code></pre>
      <p node-type="paragraph">We want to validate the following 2 JSON files whose content are the below:</p>
      <ul node-type="bullet-list">
        <li>
          <p node-type="paragraph">
            <code node-type="code">valid-product.json</code>
          </p>
        </li>
        <li>
          <p node-type="paragraph">
            <code node-type="code">invalid-product.json</code>
          </p>
        </li>
      </ul>
      <pre lang="scheme" node-type="block"><code>{
  "productId": 1,
  "productName": "A green door",
  "price": 12.50,
  "tags": [ "home", "green" ]
}
</code></pre>
      <pre lang="scheme" node-type="block"><code>{
  "productId": "This must be an integer",
  "productName": 1234,
  "price": -1
}
</code></pre>
      <p node-type="paragraph">For the simple validation, you can write the following code:</p>
      <div node-type="block" class="codeblock">
        <pre lang="scheme" node-type="block"><code>(import (rnrs)
        (text json)
        (text json schema)
        (text json validator))

(define product-catalogue-schema
  (json-schema-&gt;json-validator
   (call-with-input-file "product.schema.json" json-read)))

(define valid-catalogue
  (call-with-input-file "valid-product.json" json-read))

(define invalid-catalogue
  (call-with-input-file "invalid-product.json" json-read))

(values (validate-json product-catalogue-schema valid-catalogue)
        (validate-json product-catalogue-schema invalid-catalogue))
</code></pre>
        <span />
        <span>(values #t #f)</span>
      </div>
      <p node-type="paragraph" />
      <p node-type="paragraph">If you want to see the first invalid property, then you can write like this:</p>
      <div node-type="block" class="codeblock">
        <pre lang="scheme" node-type="block"><code>(import (rnrs)
        (text json)
        (text json schema)
        (text json validator)
        (srfi :39 parameters))

(define product-catalogue-schema
  (json-schema-&gt;json-validator
   (call-with-input-file "product.schema.json" json-read)))

(define valid-catalogue
  (call-with-input-file "valid-product.json" json-read))

(define invalid-catalogue
  (call-with-input-file "invalid-product.json" json-read))

(parameterize ((*json-schema:validator-error-reporter*
                simple-json-schema-error-reporter))
  (values (validate-json product-catalogue-schema valid-catalogue)
          (validate-json product-catalogue-schema invalid-catalogue)))
;; Prints the following
#|
/productId
        object: "This must be an integer"
        type: integer
|#
</code></pre>
        <span />
        <span>(values #t #f)</span>
      </div>
      <p node-type="paragraph" />
      <p node-type="paragraph">If you want to run as a lint mode, which goes through entire JSON,
you can write like this:</p>
      <div node-type="block" class="codeblock">
        <pre lang="scheme" node-type="block"><code>(import (rnrs)
        (text json)
        (text json schema)
        (text json validator)
        (srfi :39 parameters))

(define product-catalogue-schema
  (json-schema-&gt;json-validator
   (call-with-input-file "product.schema.json" json-read)))

(define valid-catalogue
  (call-with-input-file "valid-product.json" json-read))

(define invalid-catalogue
  (call-with-input-file "invalid-product.json" json-read))

(parameterize ((*json-schema:validator-error-reporter*
                simple-json-schema-error-reporter)
               (*json-schema:lint-mode?* #t))
  (values (validate-json product-catalogue-schema valid-catalogue)
          (validate-json product-catalogue-schema invalid-catalogue)))
;; Prints the following
#|
/productId
        object: "This must be an integer"
        type: integer
/productName
        object: 1234
        type: string
/price
        object: -1
        exclusive-minimum: 0
|#
</code></pre>
        <span />
        <span>(values #t #t)</span>
      </div>
      <p node-type="paragraph" />
      <p node-type="paragraph">NOTE: On the lint mode, the validation result will always be <code node-type="code">#t</code>.</p>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="json-schema-&gt;json-validator_37">
          <span>json-schema-&gt;json-validator</span>
          <span>
            <i node-type="i">schema</i>
          </span>
          <span>
            <i node-type="i">referencing-validators</i>
          </span>
          <span>
            <i node-type="i">...</i>
          </span>
        </a>
      </div>
      <p node-type="paragraph">Creates JSON validator object of the given JSON Schema <i node-type="i">schema</i>.</p>
      <p node-type="paragraph">The JSON Schema must be a vector represented S-expression JSON
(see <a href="section762.html#text.json">JSON parser</a>).</p>
      <p node-type="paragraph">JSON validator is described in <a href="section770.html#text.json.validator">JSON validator</a>.</p>
      <p node-type="paragraph">The optional arguments <i node-type="i">referencing-validators</i> must be
JSON Schema validators, if it's given, and will be used to reference
external schemas.</p>
      <div node-type="define" class="define">
        <span>Parameter</span>
        <a name="*json-schema:resolve-external-schema?*_125">
          <span>*json-schema:resolve-external-schema?*</span>
        </a>
      </div>
      <p node-type="paragraph">Specifying if the validator creation procedure to resolve external
reference of schema. e.g. <code node-type="code">"$ref": "http://json-schema.org/schema#"</code>.</p>
      <p node-type="paragraph">The default value is <code node-type="code">#f</code>.</p>
      <div node-type="define" class="define">
        <span>Parameter</span>
        <a name="*json-schema:validate-format?*_126">
          <span>*json-schema:validate-format?*</span>
        </a>
      </div>
      <p node-type="paragraph">Specifying if the validator validates <code node-type="code">"format"</code> keywords.</p>
      <p node-type="paragraph">The default value is <code node-type="code">#t</code>.</p>
      <div node-type="define" class="define">
        <span>Parameter</span>
        <a name="*json-schema:validator-error-reporter*_127">
          <span>*json-schema:validator-error-reporter*</span>
        </a>
      </div>
      <p node-type="paragraph">Specifying error reporter.</p>
      <p node-type="paragraph">The supporting error reporter is the  <code node-type="code">simple-json-schema-error-reporter</code>.</p>
      <div node-type="define" class="define">
        <span>Parameter</span>
        <a name="*json-schema:report-port*_124">
          <span>*json-schema:report-port*</span>
        </a>
      </div>
      <p node-type="paragraph">Specifying the port to be used to report error.</p>
      <p node-type="paragraph">The default value is <code node-type="code">(current-error-port)</code></p>
      <div node-type="define" class="define">
        <span>Parameter</span>
        <a name="*json-schema:lint-mode?*_123">
          <span>*json-schema:lint-mode?*</span>
        </a>
      </div>
      <p node-type="paragraph">Specifying if the validator should act as if it's a linter.</p>
      <p node-type="paragraph">To make this parameter effected, then
<code node-type="code">*json-schema:validator-error-reporter*</code> must also be specified.</p>
      <p node-type="paragraph">The default value is <code node-type="code">#f</code>.</p>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="simple-json-schema-error-reporter_111">
          <span>simple-json-schema-error-reporter</span>
          <span>
            <i node-type="i">report</i>
          </span>
        </a>
      </div>
      <p node-type="paragraph">The pre-defined error repoter for JSON schema validator.</p>
    </section>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section768.html">(text json schema) - JSON Schema</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section770.html">(text json validator) - JSON validator</a>
    </p>
    <div node-type="section">
      <hr>
      <p node-type="paragraph" class="author footer">This document was generated by <i node-type="i">Takashi Kato</i> with Sagittarius gendoc.<br>Generated date: <i node-type="i">2023-06-18T11:03:41+0200</i></p>
    </div>
  </body>
</html>