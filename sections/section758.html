<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <body>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section757.html">RPC support framework</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section759.html">(security keystore) - Generic Keystore Access</a>
    </p>
    <section node-type="section">
      <h2 node-type="header-2">
        <a name="lib.rpc.json">(rpc json) - JSON RPC library</a>
      </h2>
      <div node-type="define" class="define">
        <span>Library</span>
        <a name="(rpc json)_81">
          <span>(rpc json)</span>
        </a>
      </div>
      <p node-type="paragraph">This library provides procedures handling
<a href="http://www.jsonrpc.org/specification">JSON RPC 2.0</a>.</p>
      <p node-type="paragraph">This library doesn't provide transport layer. To send request and receive
response, use <a href="section757.html#utils.rpc.transport.http">Http transport</a>.</p>
      <p node-type="paragraph">This library uses <a href="section86.html#ported.json">JSON parser library</a> and its
JSON representation.</p>
      <p node-type="paragraph">Following piece of code describes how to use;</p>
      <pre lang="scheme" node-type="block"><code>(import (rnrs) (rpc json) (rpc transport http))

(define (json-rpc-send&amp;request url method param)
  (let ((request (make-json-request method :param param)))
    (let-values (((status header response) (rpc-http-request url request)))
      ;; rpc-http-request unmarshalls only when HTTP status starts with "2"
      ;; for this example we don't check it.
      (json-response-result response))))

(json-rpc-send&amp;request "http://localhost/json-rpc" "sample" "parameter")
;; -&gt; result of method execution
</code></pre>
      <div node-type="define" class="define">
        <span>Class</span>
        <a name="<json-request&gt;_31">
          <span>&lt;json-request&gt;</span>
        </a>
      </div>
      <div node-type="define" class="define">
        <span>Class</span>
        <a name="<json-response&gt;_32">
          <span>&lt;json-response&gt;</span>
        </a>
      </div>
      <p node-type="paragraph">These classes represents JSON RPC request and response respectively.</p>
      <p node-type="paragraph">The class instance should be created by <code node-type="code">make-json-request</code>,
<code node-type="code">json-string-&gt;json-request</code> or <code node-type="code">json-string-&gt;json-response</code>. Users
should not create an instance directly using <code node-type="code">make</code>.</p>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Predicates">Predicates</a>
        </h3>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-request?_32">
            <span>json-request?</span>
            <span>
              <i node-type="i">object</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-response?_36">
            <span>json-response?</span>
            <span>
              <i node-type="i">object</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph">Returns #t if the given <i node-type="i">object</i> is an instance of
<code node-type="code">&lt;json-request&gt;</code> and <code node-type="code">&lt;json-response&gt;</code> respectively.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Constructors">Constructors</a>
        </h3>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="make-json-request_157">
            <span>make-json-request</span>
            <span>
              <i node-type="i">method</i>
            </span>
            <span>
              <i node-type="i">:key</i>
            </span>
            <span>
              <i node-type="i">(params</i>
            </span>
            <span>
              <i node-type="i">'())</i>
            </span>
            <span>
              <i node-type="i">id</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph">Creates a JSON RPC request.</p>
        <p node-type="paragraph"><i node-type="i">method</i> must be a symbol or string represents method name to be invoked.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">params</i> is the <code node-type="code">params</code> field of the JSON
RPC protocol.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">id</i> is the <code node-type="code">id</code> field of the JSON RPC protocol.
If this is not specified then a value generated by UUID v4 will be used.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-string-&gt;json-request_38">
            <span>json-string-&gt;json-request</span>
            <span>
              <i node-type="i">json</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-string-&gt;json-response_39">
            <span>json-string-&gt;json-response</span>
            <span>
              <i node-type="i">json</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph">Creates JSON RPC request and response from given JSON string <i node-type="i">json</i>.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Accessors">Accessors</a>
        </h3>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-request-method_30">
            <span>json-request-method</span>
            <span>
              <i node-type="i">json-request</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-request-params_31">
            <span>json-request-params</span>
            <span>
              <i node-type="i">json-request</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-request-id_29">
            <span>json-request-id</span>
            <span>
              <i node-type="i">json-request</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph">Retrieves JSON RPC request's method, params and id respectively from given
json request object <i node-type="i">json-request</i>.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-response-result_35">
            <span>json-response-result</span>
            <span>
              <i node-type="i">json-response</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-response-id_34">
            <span>json-response-id</span>
            <span>
              <i node-type="i">json-response</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph">Retrieves JSON RPC response's result and id respectively from given
json response object <i node-type="i">json-response</i>.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Converters">Converters</a>
        </h3>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-request-&gt;json-string_28">
            <span>json-request-&gt;json-string</span>
            <span>
              <i node-type="i">json-request</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="json-response-&gt;json-string_33">
            <span>json-response-&gt;json-string</span>
            <span>
              <i node-type="i">json-response</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph">Converts given <i node-type="i">json-request</i> and <i node-type="i">json-response</i> to JSON string.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Implemented-methods">Implemented methods</a>
        </h3>
        <p node-type="paragraph">Following methods are currently used only in <code node-type="code">(rpc http transport)</code>.
When we support other transport, this implementation may change.</p>
        <section node-type="section">
          <h4 node-type="header-4">
            <a name="Message-methods">Message methods</a>
          </h4>
          <div node-type="define" class="define">
            <span>Method</span>
            <a name="rpc-marshall-message_139">
              <span>rpc-marshall-message</span>
              <span>
                <i node-type="i">(message</i>
              </span>
              <span>
                <i node-type="i"><json-request>)</i>
              </span>
            </a>
          </div>
          <p node-type="paragraph">Converts to given JSON RPC request object to UTF8 bytes.</p>
          <div node-type="define" class="define">
            <span>Method</span>
            <a name="rpc-unmarshall-message_141">
              <span>rpc-unmarshall-message</span>
              <span>
                <i node-type="i">(type</i>
              </span>
              <span>
                <i node-type="i">(eql</i>
              </span>
              <span>
                <i node-type="i">'json))</i>
              </span>
              <span>
                <i node-type="i">body</i>
              </span>
            </a>
          </div>
          <p node-type="paragraph">Converts to given UTF8 bytes to JSON RPC response object.</p>
        </section>
        <section node-type="section">
          <h4 node-type="header-4">
            <a name="Transport-methods">Transport methods</a>
          </h4>
          <div node-type="define" class="define">
            <span>Method</span>
            <a name="rpc-http-content-type_130">
              <span>rpc-http-content-type</span>
              <span>
                <i node-type="i">(message</i>
              </span>
              <span>
                <i node-type="i"><json-request>)</i>
              </span>
            </a>
          </div>
          <p node-type="paragraph">Returns <code node-type="code">application/json</code> content type header value</p>
          <div node-type="define" class="define">
            <span>Method</span>
            <a name="rpc-http-response-type_135">
              <span>rpc-http-response-type</span>
              <span>
                <i node-type="i">(message</i>
              </span>
              <span>
                <i node-type="i"><json-request>)</i>
              </span>
            </a>
          </div>
          <p node-type="paragraph">Returns <code node-type="code">json</code> symbol.</p>
        </section>
      </section>
    </section>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section757.html">RPC support framework</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section759.html">(security keystore) - Generic Keystore Access</a>
    </p>
    <div node-type="section">
      <hr>
      <p node-type="paragraph" class="author footer">This document was generated by <i node-type="i">Takashi Kato</i> with Sagittarius gendoc.<br>Generated date: <i node-type="i">2022-09-01T15:20:01+0200</i></p>
    </div>
  </body>
</html>