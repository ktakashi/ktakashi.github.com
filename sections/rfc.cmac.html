<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <body>
    <p node-type="paragraph" class="navigation-container">
      <a href="./rfc.base64.html">(rfc base64) - Base 64 encode and decode library</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./rfc.hmac.html">(rfc hmac) - HMAC library</a>
    </p>
    <section node-type="section">
      <h2 node-type="header-2">
        <a name="rfc.cmac">(rfc cmac) - CMAC library</a>
      </h2>
      <p node-type="paragraph">This section describes the CMAC extension of hash algorithm. The CMAC itself
is described <a href="http://tools.ietf.org/html/rfc4493">RFC 4493</a>.</p>
      <div node-type="define" class="define">
        <span>Library</span>
        <a name="(rfc cmac)_35">
          <span>(rfc cmac)</span>
        </a>
      </div>
      <p node-type="paragraph">This library is kept only for backward compatibility purpose. For
newer application, use <a href="lib.sagittarius.crypto.html#sagittarius.crypto.mac">
        <code node-type="code">(sagittarius crypto mac)</code>
      </a>.</p>
      <p node-type="paragraph">Provides CMAC hash algorithm.</p>
      <p node-type="paragraph">The RFC is defined for only AES block cipher however the implementation
can take any block cipher such as DES3.</p>
      <p node-type="paragraph">CAUTION: only AES cipher is tested.</p>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="make-cmac_70">
          <span>make-cmac</span>
          <span>
            <i node-type="i">key</i>
          </span>
          <span>
            <i node-type="i">opts</i>
          </span>
          <span>
            <i node-type="i">...</i>
          </span>
        </a>
      </div>
      <p node-type="paragraph">Creates a MAC object of CMAC algorithm.
<i node-type="i">key</i> must be a bytevector.</p>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="generate-mac_14">
          <span>generate-mac</span>
          <span> (</span>
          <span>
            <i node-type="i">mac</i>
          </span>
          <span>
            <code node-type="code">mac?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">message</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>) :optional </span>
          <span>
            <i node-type="i">length</i>
          </span>
        </a>
      </div>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="generate-mac!_16">
          <span>generate-mac!</span>
          <span> (</span>
          <span>
            <i node-type="i">mac</i>
          </span>
          <span>
            <code node-type="code">mac?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">message</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">out</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>) :optional </span>
          <span>
            <i node-type="i">start</i>
          </span>
          <span>
            <i node-type="i">length</i>
          </span>
        </a>
      </div>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="verify-mac_44">
          <span>verify-mac</span>
          <span> (</span>
          <span>
            <i node-type="i">mac</i>
          </span>
          <span>
            <code node-type="code">mac?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">message</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">auth-mac</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>)</span>
        </a>
      </div>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="mac-init!_3">
          <span>mac-init!</span>
          <span> (</span>
          <span>
            <i node-type="i">mac</i>
          </span>
          <span>
            <code node-type="code">mac?</code>
          </span>
          <span>)</span>
        </a>
      </div>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="mac-process!_7">
          <span>mac-process!</span>
          <span> (</span>
          <span>
            <i node-type="i">mac</i>
          </span>
          <span>
            <code node-type="code">mac?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">message</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>) :optional </span>
          <span>
            <i node-type="i">start</i>
          </span>
          <span>
            <i node-type="i">length</i>
          </span>
        </a>
      </div>
      <div node-type="define" class="define">
        <span>Function</span>
        <a name="mac-done!_1">
          <span>mac-done!</span>
          <span> (</span>
          <span>
            <i node-type="i">mac</i>
          </span>
          <span>
            <code node-type="code">mac?</code>
          </span>
          <span>) (</span>
          <span>
            <i node-type="i">out</i>
          </span>
          <span>
            <code node-type="code">bytevector?</code>
          </span>
          <span>) :optional </span>
          <span>
            <i node-type="i">start</i>
          </span>
          <span>
            <i node-type="i">length</i>
          </span>
        </a>
      </div>
      <p node-type="paragraph">These procedures are re-exported from <code node-type="code">(sagittarius crypto mac)</code>.</p>
      <div node-type="define" class="define">
        <span>Variable</span>
        <a name="CMAC_114">
          <span>CMAC</span>
          <span>
            <deprecated node-type="deprecated" />
          </span>
        </a>
      </div>
      <p node-type="paragraph">The name for CMAC hash algorithm, which can be used with <code node-type="code">(math hash)</code> library.</p>
      <p node-type="paragraph">The following example explains, how to use it.</p>
      <pre lang="scheme" node-type="block"><code>(import (rnrs) (rfc cmac) (math) (crypto))

(define K (generate-secret-key AES (integer-&gt;bytevector 
				    #x2b7e151628aed2a6abf7158809cf4f3c)))

(define aes-cipher (cipher AES K))

(hash CMAC #vu8() :cipher aes-cipher)
;; =&gt; #vu8(187 29 105 41 233 89 55 40 127 163 125 18 155 117 103 70)

;; for AES-CMAC-96
(hash CMAC #vu8() :cipher aes-cipher :size (/ 96 8))
;; =&gt; #vu8(187 29 105 41 233 89 55 40 127 163 125 18)
</code></pre>
    </section>
    <p node-type="paragraph" class="navigation-container">
      <a href="./rfc.base64.html">(rfc base64) - Base 64 encode and decode library</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./rfc.hmac.html">(rfc hmac) - HMAC library</a>
    </p>
    <div node-type="section">
      <hr>
      <p node-type="paragraph" class="author footer">This document was generated by <i node-type="i">Takashi Kato</i> with Sagittarius gendoc.<br>Generated date: <i node-type="i">2025-06-20T16:07:29+0200</i></p>
    </div>
  </body>
</html>