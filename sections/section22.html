<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <body>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section21.html">Invoking Sagittarius</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section23.html">Working on REPL</a>
    </p>
    <section node-type="section">
      <h2 node-type="header-2">
        <a name="Writing-Scheme-scripts">Writing Scheme scripts</a>
      </h2>
      <p node-type="paragraph">When a Scheme file is given to <code node-type="code">sagittarius</code>, it bounds an internal
variable to list of the remaining command-line arguments which you can get with
the <code node-type="code">command-line</code> procedure, then loads the Scheme program. If the first
line of scheme-file begins with <code node-type="code">"#!"</code>, then Sagittarius ignores the
entire line. This is useful to write a Scheme program that works as an
executable script in unix-like systems.</p>
      <p node-type="paragraph">Typical Sagittarius script has the first line like this:</p>
      <p node-type="paragraph">
        <pre lang="" node-type="snipet"><code>#!/usr/local/bin/sagittarius</code></pre>
      </p>
      <p node-type="paragraph">or</p>
      <p node-type="paragraph">
        <pre lang="" node-type="snipet"><code>#!/bin/env sagittarius</code></pre>
      </p>
      <p node-type="paragraph">The second form uses "shell trampoline" technique so that the script works as
far as <code node-type="code">sagittarius</code> is in the PATH.</p>
      <p node-type="paragraph">After the script file is successfully loaded, then Sagittarius will process all
toplevel expression the same as Perl.</p>
      <p node-type="paragraph">Now I show a simple example below. This script works like <code node-type="code">cat(1)</code>, without
any command-line option processing and error handling.</p>
      <pre lang="scheme" node-type="block"><code>#!/usr/local/bin/sagittarius
(import (rnrs))
(let ((args (command-line)))
  (unless (null? (cdr args))
    (for-each (lambda (file)
		(call-with-input-file file
		  (lambda (in)
		    (display (get-string-all in)))))
	      (cdr args)))
  0)
</code></pre>
      <p node-type="paragraph">If the script file contains <code node-type="code">main</code> procedure, then Sagittarius execute
it as well with one argument which contains all command line arguments. This
feature is defined in
<a href="http://srfi.schemers.org/srfi-22/">SRFI-22</a>. So the
above example can also be written like the following:</p>
      <pre lang="scheme" node-type="block"><code>#!/usr/local/bin/sagittarius
(import (rnrs))
(define (main args)
  (unless (null? (cdr args))
    (for-each (lambda (file)
		(call-with-input-file file
		  (lambda (in)
		    (display (get-string-all in)))))
	      (cdr args)))
  0)
</code></pre>
      <p node-type="paragraph">NOTE: the <code node-type="code">main</code> procedure is called after all toplevel expressions
are executed.</p>
    </section>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section21.html">Invoking Sagittarius</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section23.html">Working on REPL</a>
    </p>
    <div node-type="section">
      <hr>
      <p node-type="paragraph" class="author footer">This document was generated by <i node-type="i">Takashi Kato</i> with Sagittarius gendoc.<br>Generated date: <i node-type="i">2023-06-18T11:03:41+0200</i></p>
    </div>
  </body>
</html>