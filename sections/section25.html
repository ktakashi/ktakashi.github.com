<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <body>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section24.html">Writing a library</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section3.html">R6RS Libraries</a>
    </p>
    <section node-type="section">
      <h2 node-type="header-2">
        <a name="Compiled-cache">Compiled cache</a>
      </h2>
      <p node-type="paragraph">For better starting time, Sagittarius caches compiled libraries. The cache files
are stored in one of the following environment variables;</p>
      <p node-type="paragraph">For Unix like (POSIX) environment:</p>
      <ul node-type="bullet-list">
        <li>
          <p node-type="paragraph">
            <code node-type="code">SAGITTARIUS_CACHE_DIR</code>
          </p>
        </li>
        <li>
          <p node-type="paragraph">
            <code node-type="code">HOME</code>
          </p>
        </li>
      </ul>
      <p node-type="paragraph">For Windows environment:</p>
      <ul node-type="bullet-list">
        <li>
          <p node-type="paragraph">
            <code node-type="code">SAGITTARIUS_CACHE_DIR</code>
          </p>
        </li>
        <li>
          <p node-type="paragraph">
            <code node-type="code">TEMP</code>
          </p>
        </li>
        <li>
          <p node-type="paragraph">
            <code node-type="code">TMP</code>
          </p>
        </li>
      </ul>
      <p node-type="paragraph">Sagittarius will use the variables respectively, so if the
<code node-type="code">SAGITTARIUS_CACHE_DIR</code> is found then it will be used.</p>
      <p node-type="paragraph">The caching compiled file is carefully designed however the cache file might be
stored in broken state. In that case use <code node-type="code">-c</code> option with
<code node-type="code">sagittarius</code>, then it will wipe all cache files. If you don't want to use
it, pass <code node-type="code">-d</code> option then Sagittarius won't use it.</p>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Precompiling-cache-file">Precompiling cache file</a>
        </h3>
        <p node-type="paragraph">Users can provide own library with precompile script. The script looks like
this;</p>
        <pre lang="scheme" node-type="block"><code>(import (the-library-1)
        (the-library-2))
</code></pre>
        <p node-type="paragraph">When this script is run, then the libraries will be cached in the cache
directory.</p>
        <p node-type="paragraph">Note: The cache files are stored with the names converted from original library
files' absolute path. So it is important that users' libraries are already
installed before precompiling, otherwise Sagittarius won't use the precompiled
cache files.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Deviate">Deviate</a>
        </h3>
        <p node-type="paragraph">Some of the behaviours are not compliant or deviate from other implementations.
Here, we list some of them.</p>
        <section node-type="section">
          <h4 node-type="header-4">
            <a name="Macro-expansion">Macro expansion</a>
          </h4>
          <p node-type="paragraph">The following code will print <code node-type="code">#t</code> instead of <code node-type="code">#f</code> with <code node-type="code">-r6</code>command line option or doing it on a library:</p>
          <pre lang="scheme" node-type="block"><code>(import (rnrs) (for (rnrs eval) expand))

(define-syntax foo
  (lambda(ctx)
    (syntax-case ctx ()
      ((_ id)
       (free-identifier=?
	#'id
	(eval '(datum-&gt;syntax #'k 'bar) (environment '(rnrs))))))))

(define bar)

(display (foo bar))
</code></pre>
          <p node-type="paragraph">This is because, Sagittarius doesn't have separated phases of macro expansion
and compilation. When <code node-type="code">foo</code> is expanded, then the <code node-type="code">bar</code> is not defined
yet or at least it's not visible during the macro expansion. So, both _bar_s
are not bound, then <code node-type="code">free-identifier=?</code> will consider them the same
identifiers.</p>
        </section>
      </section>
    </section>
    <p node-type="paragraph" class="navigation-container">
      <a href="./section24.html">Writing a library</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./section3.html">R6RS Libraries</a>
    </p>
    <div node-type="section">
      <hr>
      <p node-type="paragraph" class="author footer">This document was generated by <i node-type="i">Takashi Kato</i> with Sagittarius gendoc.<br>Generated date: <i node-type="i">2023-06-18T11:03:41+0200</i></p>
    </div>
  </body>
</html>