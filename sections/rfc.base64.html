<html>
  <head>
    <meta charset="utf-8">
    <meta http-eqiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" type="text/css" href="../lib/style.css">
    <title>Sagittarius Users' Reference</title>
  </head>
  <body>
    <p node-type="paragraph" class="navigation-container">
      <a href="./rfc.base32.html">(rfc base32) - Base 32 encode and decode library</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./rfc.cmac.html">(rfc cmac) - CMAC library</a>
    </p>
    <section node-type="section">
      <h2 node-type="header-2">
        <a name="rfc.base64">(rfc base64) - Base 64 encode and decode library</a>
      </h2>
      <div node-type="define" class="define">
        <span>Library</span>
        <a name="(rfc base64)_34">
          <span>(rfc base64)</span>
        </a>
      </div>
      <p node-type="paragraph">This library provides Base 64 encoding and decoding procedures.</p>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Encoding-procedures">Encoding procedures</a>
        </h3>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64-encode_11">
            <span>base64-encode</span>
            <span>
              <i node-type="i">in</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> 76) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #t)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64url-encode_15">
            <span>base64url-encode</span>
            <span>
              <i node-type="i">in</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <p node-type="paragraph"><i node-type="i">in</i> must be either a bytevector or binary input port.</p>
        <p node-type="paragraph">Encodes given input <i node-type="i">in</i> to Base 64 encoded bytevector.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">line-width</i> specifies where the encode procedure
should put linefeed. If this is less than 1 or #f, encoder does not put
linefeed.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">padding?</i> controls if the result encoded value
contains padding character <code node-type="code">#\=</code> or not. If this is #f, then the result
value won't contain padding character.</p>
        <p node-type="paragraph">The <code node-type="code">base64url-encode</code> encodes the given input to Base 64 URL safe
encoded bytevector. Which doesn't use <code node-type="code">+</code> and <code node-type="code">/</code>.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64-encode-string_12">
            <span>base64-encode-string</span>
            <span>
              <i node-type="i">string</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> 76) </span>
            <span>
              <i node-type="i">transcoder</i>
            </span>
            <span> (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #t)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64url-encode-string_16">
            <span>base64url-encode-string</span>
            <span>
              <i node-type="i">string</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> #f) </span>
            <span>
              <i node-type="i">transcoder</i>
            </span>
            <span> (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <p node-type="paragraph">Convenient procedure for string.</p>
        <p node-type="paragraph">Encodes given <i node-type="i">string</i> to Base 64 encoded string.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">transcoder</i> is used to convert given string to
bytevector. The converted bytevector will be passed to the <code node-type="code">base64-encode</code>
procedure. The default value is a transcoder with UTF-8 codec with EOL
style none.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">padding?</i> is the same as <code node-type="code">base64-encode</code>.</p>
        <p node-type="paragraph">The <code node-type="code">base64url-encode-string</code> encodes the given input to Base 64 URL safe
encoded bytevector. Which doesn't use <code node-type="code">+</code> and <code node-type="code">/</code>.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64-encode-input-port_30">
            <span>open-base64-encode-input-port</span>
            <span>
              <i node-type="i">source</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #t)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64-encode-output-port_31">
            <span>open-base64-encode-output-port</span>
            <span>
              <i node-type="i">sink</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #t)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64url-encode-input-port_34">
            <span>open-base64url-encode-input-port</span>
            <span>
              <i node-type="i">source</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64url-encode-output-port_35">
            <span>open-base64url-encode-output-port</span>
            <span>
              <i node-type="i">sink</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> #f) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <p node-type="paragraph">Creates binary Base64 encode input and output port, respectively.</p>
        <p node-type="paragraph"><i node-type="i">source</i> must be binary inpurt port.</p>
        <p node-type="paragraph">The input port reads bytes from <i node-type="i">source</i> and returns Base64 encoded
result.</p>
        <p node-type="paragraph"><i node-type="i">sink</i> must be binary inpurt port.</p>
        <p node-type="paragraph">The output port puts encoded bytes to <i node-type="i">sink</i>. The port must be closed
to finish the encoding process properly.</p>
        <p node-type="paragraph">The keyword argument <i node-type="i">padding?</i> is the same as <code node-type="code">base64-encode</code>.</p>
        <p node-type="paragraph">The <code node-type="code">open-base64url-encode-input-port</code> and
<code node-type="code">open-base64url-encode-output-port</code> encode to Base64 URL safe encode.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Decoding-procedures">Decoding procedures</a>
        </h3>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64-decode_9">
            <span>base64-decode</span>
            <span>
              <i node-type="i">in</i>
            </span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64url-decode_13">
            <span>base64url-decode</span>
            <span>
              <i node-type="i">in</i>
            </span>
          </a>
        </div>
        <p node-type="paragraph"><i node-type="i">in</i> must be a bytevector or binary input port.</p>
        <p node-type="paragraph">Decode Base 64 encoded input <i node-type="i">in</i> to original bytevector.</p>
        <p node-type="paragraph">The <code node-type="code">base64url-decode</code> decodes Base64 URL safe encoded value.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64-decode-string_10">
            <span>base64-decode-string</span>
            <span>
              <i node-type="i">string</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">transcoder</i>
            </span>
            <span>
              <code node-type="code">(native-transcoder)</code>
            </span>
            <span>)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="base64url-decode-string_14">
            <span>base64url-decode-string</span>
            <span>
              <i node-type="i">string</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">transcoder</i>
            </span>
            <span>
              <code node-type="code">(native-transcoder)</code>
            </span>
            <span>)</span>
          </a>
        </div>
        <p node-type="paragraph">Convenient procedure.</p>
        <p node-type="paragraph">Decode Base 64 encoded string to original string. The procedure is using
<code node-type="code">base64-decode</code>.</p>
        <p node-type="paragraph">The keyword argument specifies how to convert the decoded bytevector to string.
If this is #f, the procedure returns raw bytevector.</p>
        <p node-type="paragraph">The <code node-type="code">base64url-decode-string</code> decodes Base64 URL safe encoded value.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64-decode-input-port_28">
            <span>open-base64-decode-input-port</span>
            <span>
              <i node-type="i">source</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64-decode-output-port_29">
            <span>open-base64-decode-output-port</span>
            <span>
              <i node-type="i">sink</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64url-decode-input-port_32">
            <span>open-base64url-decode-input-port</span>
            <span>
              <i node-type="i">source</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="open-base64url-decode-output-port_33">
            <span>open-base64url-decode-output-port</span>
            <span>
              <i node-type="i">sink</i>
            </span>
            <span> :key (</span>
            <span>
              <i node-type="i">owner?</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <p node-type="paragraph">Creates binary Base64 decode input and output port, respectively.</p>
        <p node-type="paragraph"><i node-type="i">source</i> must be binary inpurt port.</p>
        <p node-type="paragraph">The input port reads Base64 encoded bytes from <i node-type="i">source</i> and returns
decoded results.</p>
        <p node-type="paragraph"><i node-type="i">sink</i> must be binary inpurt port.</p>
        <p node-type="paragraph">The output port puts decoded bytes to <i node-type="i">sink</i>. The port must be closed
to finish the encoding process properly.</p>
        <p node-type="paragraph">The <code node-type="code">open-base64url-decode-input-port</code> and
<code node-type="code">open-base64url-decode-output-port</code> decode Base64 URL safe encoded
value.</p>
      </section>
      <section node-type="section">
        <h3 node-type="header-3">
          <a name="Low-level-APIs">Low level APIs</a>
        </h3>
        <p node-type="paragraph">Both encode and decode procedures are using encoder and decoder. Both
encoder and decoder are just a procedure which takes 2 arguments
<i node-type="i">get</i> and <i node-type="i">put</i> and not reentrant as they have own internal
buffer to process the input.</p>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="make-base64-encoder_45">
            <span>make-base64-encoder</span>
            <span>  :key (</span>
            <span>
              <i node-type="i">encode-table</i>
            </span>
            <span>
              <code node-type="code">*base64-encode-table*</code>
            </span>
            <span>) (</span>
            <span>
              <i node-type="i">line-width</i>
            </span>
            <span> 76) (</span>
            <span>
              <i node-type="i">padding?</i>
            </span>
            <span> #t) (</span>
            <span>
              <i node-type="i">linefeeds</i>
            </span>
            <span> #f)</span>
          </a>
        </div>
        <p node-type="paragraph"><i node-type="i">encode-table</i> must be a valid Base 32 encode table.<br><i node-type="i">line-width</i> must be either <code node-type="code">#f</code> or integer.<br><i node-type="i">padding?</i> must be a boolean value.<br><i node-type="i">linefeeds</i> must be <code node-type="code">#f</code> or u8 list reporesents end of line.__</p>
        <p node-type="paragraph">Creates a Base64 encoder. An encoder is a procedure which takes 2
arguments <i node-type="i">get</i> and <i node-type="i">put</i>.</p>
        <p node-type="paragraph"><i node-type="i">get</i> must be a procedure takes 0 argument and it must return one
of the followings; a fixnum of range 0 to 255, EOF object, or negative
integer. The fixnum value is treated as an input of the encoding
value. The negative integer value is treated as a continue
marker. When the encoder receives this value, then it won't encode
until the next value is available.</p>
        <p node-type="paragraph"><i node-type="i">put</i> must be a procedure takes 1 argument which is either a
fixnum of range 0 to 255 or <code node-type="code">#f</code>. The fixnum is the encoded value
of the input. <code node-type="code">#f</code> indicates line break point, so user can
determine which line break this encoder should use.</p>
        <p node-type="paragraph">The following shows how to make Base64 encoder with line break of CRLF.</p>
        <pre lang="scheme" node-type="block"><code>(define (base64-encode-w/crlf bv)
  (let-values (((out e) (open-bytevector-output-port)))
    (define (put v)
      (if v
	  (put-u8 out v)
	  (begin (put-u8 out #x0d) (put-u8 out #x0a))))
    (define inp (open-bytevector-input-port bv))
    (define (in) (get-u8 inp))
    (define encoder (make-base64-encoder))
    (do () ((encoder in put)))
    (e)))
</code></pre>
        <div node-type="define" class="define">
          <span>Function</span>
          <a name="make-base64-decoder_44">
            <span>make-base64-decoder</span>
            <span> :key (</span>
            <span>
              <i node-type="i">decode-table</i>
            </span>
            <span>
              <code node-type="code">*base64-decode-table*</code>
            </span>
            <span>)</span>
          </a>
        </div>
        <p node-type="paragraph">Creates a Base64 decoder. A decoder is a procedure which takes 2
arguments <i node-type="i">get</i> and <i node-type="i">put</i>.</p>
        <p node-type="paragraph"><i node-type="i">get</i> is the same as the one from encoder.</p>
        <p node-type="paragraph"><i node-type="i">put</i> must be a procedure takes 1 arguments which is a fixnm of
range 0 to 255. The value is always a decoded byte.</p>
        <div node-type="define" class="define">
          <span>Constant</span>
          <a name="*base64-encode-table*_8">
            <span>*base64-encode-table*</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Constant</span>
          <a name="*base64-decode-table*_6">
            <span>*base64-decode-table*</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Constant</span>
          <a name="*base64-encode-url-table*_9">
            <span>*base64-encode-url-table*</span>
          </a>
        </div>
        <div node-type="define" class="define">
          <span>Constant</span>
          <a name="*base64-decode-url-table*_7">
            <span>*base64-decode-url-table*</span>
          </a>
        </div>
        <p node-type="paragraph">Default encode or decode tables. If the name contains <code node-type="code">url</code>, then it
is suitable for "base64url".</p>
      </section>
    </section>
    <p node-type="paragraph" class="navigation-container">
      <a href="./rfc.base32.html">(rfc base32) - Base 32 encode and decode library</a>
      <a href="../sagittarius-online-ref.html">Top</a>
      <a href="./rfc.cmac.html">(rfc cmac) - CMAC library</a>
    </p>
    <div node-type="section">
      <hr>
      <p node-type="paragraph" class="author footer">This document was generated by <i node-type="i">Takashi Kato</i> with Sagittarius gendoc.<br>Generated date: <i node-type="i">2025-06-20T16:07:29+0200</i></p>
    </div>
  </body>
</html>